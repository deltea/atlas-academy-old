---
import BaseLayout from "$layouts/BaseLayout.astro";
import PageCover from "$components/PageCover.astro";

import { contentfulClient } from "$lib/contentful";
import type { BlogPost } from "$lib/contentful";

const entries = await contentfulClient.getEntries<BlogPost>({
  content_type: "blogPost",
});

const posts = entries.items.map(item => {
  const { title, date, slug } = item.fields;

  return {
    title,
    slug,
    date: new Date(date).toLocaleDateString(),
  }
});
---

<BaseLayout>
  <PageCover center cover="/covers/home.webp" slot="before-content">
    <h1>義大利 ITALY</h1>
  </PageCover>

  <h1>Blog</h1>

  <ul>
    {posts.map(post => (
      <li>
        <a href={`/posts/${post.slug}/`}>
          <h2>{post.title}</h2>
        </a>
        <time>{post.date}</time>
      </li>
    ))}
  </ul>
</BaseLayout>
